#!/usr/bin/env bash
set -e

# ===== COLORS =====
G=$'\033[32m'
R=$'\033[31m'
C=$'\033[36m'
Y=$'\033[33m'
W=$'\033[97m'
N=$'\033[0m'

pause(){ read -p "Press Enter to continue..." temp; }

# ===== BOOT ANIMATION =====
typewriter() {
    text="$1"
    for ((i=0; i<${#text}; i++)); do
        echo -ne "${text:$i:1}"
        sleep 0.02
    done
    echo ""
}

boot_animation(){
clear
echo -e "${C}"
typewriter "Initializing Tyrkrox Hyper System..."
sleep 0.5
typewriter "Loading Core Modules..."
sleep 0.5
typewriter "Checking System Compatibility..."
sleep 0.5
echo -e "${G}System Ready ‚úÖ${N}"
sleep 1
}

header(){
clear
echo -e "${C}"
echo "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó"
echo "‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ïö‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"
echo "   ‚ñà‚ñà‚ïë    ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù"
echo "   ‚ñà‚ñà‚ïë     ‚ïö‚ñà‚ñà‚ïî‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"
echo "   ‚ñà‚ñà‚ïë      ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë"
echo "   ‚ïö‚ïê‚ïù      ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù"
echo -e "${Y}=========== TYRKROX CONTROL PANEL ===========${N}"
echo ""
}

# ===== AUTO CHECK =====
install_docker(){
if ! command -v docker &> /dev/null; then
    echo -e "${Y}Installing Docker...${N}"
    apt update -y
    apt install -y docker.io
fi
}

# ================= PANEL =================

install_panel(){
header
apt update -y
apt install -y nginx mysql-server php php-fpm curl unzip
mkdir -p /var/www/panel
echo "Panel Installed Successfully" > /var/www/panel/index.html
systemctl restart nginx
echo -e "${G}Panel Installed Successfully ‚úÖ${N}"
pause
}

create_panel_user(){
header
read -p "Username: " user
read -p "Password: " pass
useradd -m $user
echo "$user:$pass" | chpasswd
echo -e "${G}User Created Successfully ‚úÖ${N}"
pause
}

update_panel(){
header
apt update -y && apt upgrade -y
echo -e "${G}System Updated Successfully ‚úÖ${N}"
pause
}

uninstall_panel(){
header
rm -rf /var/www/panel
apt remove -y nginx mysql-server php*
echo -e "${R}Panel Removed Successfully ‚ùå${N}"
pause
}

panel_menu(){
while true; do
header
echo "[1] Install Panel"
echo "[2] Create Panel User"
echo "[3] Update Panel"
echo "[4] Uninstall Panel"
echo "[0] Back"
echo ""

read -p "Select Option: " p
case $p in
1) install_panel ;;
2) create_panel_user ;;
3) update_panel ;;
4) uninstall_panel ;;
0) break ;;
*) echo "Invalid Option"; sleep 1 ;;
esac
done
}

# ================= IVM (DOCKER VM MANAGER) =================

ivm_menu(){
install_docker
while true; do
header
echo -e "${C}IVM MANAGER (Docker Based)${N}"
echo ""
echo "1) Create Container"
echo "2) Start Container"
echo "3) Stop Container"
echo "4) Delete Container"
echo "5) List Containers"
echo "0) Back"
echo ""

read -p "Select Option: " i
case $i in
1)
read -p "Container Name: " NAME
docker run -dit --name $NAME ubuntu:22.04
echo -e "${G}Container Created ‚úÖ${N}"
pause ;;
2)
read -p "Container Name: " NAME
docker start $NAME
pause ;;
3)
read -p "Container Name: " NAME
docker stop $NAME
pause ;;
4)
read -p "Container Name: " NAME
docker rm -f $NAME
pause ;;
5)
docker ps -a
pause ;;
0) break ;;
*) echo "Invalid"; sleep 1 ;;
esac
done
}

# ================= KVM MANAGER =================

kvm_menu(){
header
if ! egrep -q '(vmx|svm)' /proc/cpuinfo; then
echo -e "${R}‚ùå KVM NOT Supported on this system${N}"
pause
return
fi

apt install -y qemu-kvm libvirt-daemon-system virtinst

while true; do
header
echo -e "${C}SYSTEM MANAGER ACTIVE ‚ñ∫ Pure QEMU Environment${N}"
echo ""
echo "1) Create VM"
echo "2) List VMs"
echo "3) Start VM"
echo "4) Stop VM"
echo "5) Delete VM"
echo "0) Back"
echo ""

read -p "Select Option: " k
case $k in
1)
read -p "VM Name: " VMNAME
qemu-img create -f qcow2 /var/lib/libvirt/images/$VMNAME.qcow2 10G
echo -e "${G}VM Disk Created (10GB) ‚úÖ${N}"
pause ;;
2)
virsh list --all
pause ;;
3)
read -p "VM Name: " VMNAME
virsh start $VMNAME
pause ;;
4)
read -p "VM Name: " VMNAME
virsh shutdown $VMNAME
pause ;;
5)
read -p "VM Name: " VMNAME
virsh undefine $VMNAME
pause ;;
0) break ;;
*) echo "Invalid"; sleep 1 ;;
esac
done
}

# ================= WINGS =================

install_wings(){
install_docker
echo -e "${G}Wings Installed (Docker Ready) ‚úÖ${N}"
pause
}

# ================= PROXMOX =================

install_proxmox(){
install_docker
docker run -itd --name proxmoxve --privileged -p 8006:8006 rtedpro/proxmox:9.0.11
echo -e "${G}Proxmox Running on Port 8006 üöÄ${N}"
pause
}

# ================= START =================

boot_animation

while true; do
header
echo "[1] Panel Install"
echo "[2] Install Wings"
echo "[3] IVM Manager"
echo "[4] KVM Manager"
echo "[5] Install Proxmox"
echo "[0] Exit"
echo ""

read -p "Select Option: " opt

case $opt in
1) panel_menu ;;
2) install_wings ;;
3) ivm_menu ;;
4) kvm_menu ;;
5) install_proxmox ;;
0) exit 0 ;;
*) echo "Invalid Option"; sleep 1 ;;
esac

done
