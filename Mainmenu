#!/usr/bin/env bash
set -e

# ===== COLORS =====
G=$'\033[32m'
R=$'\033[31m'
C=$'\033[36m'
Y=$'\033[33m'
W=$'\033[97m'
N=$'\033[0m'

# ===== ANIMATION =====
typewriter() {
    text="$1"
    for ((i=0; i<${#text}; i++)); do
        echo -ne "${text:$i:1}"
        sleep 0.02
    done
    echo ""
}

spinner() {
    pid=$!
    spin='-\|/'
    i=0
    while kill -0 $pid 2>/dev/null; do
        i=$(( (i+1) %4 ))
        printf "\r${Y}Loading ${spin:$i:1}${N}"
        sleep .1
    done
    printf "\r"
}

boot_animation() {
clear
echo -e "${C}"
typewriter "Initializing Tyrkrox Hyper System..."
sleep 0.4
typewriter "Loading Modules..."
sleep 0.4
typewriter "Checking Virtualization..."
sleep 0.4
echo -e "${G}System Ready âœ…${N}"
sleep 1
}

header() {
clear
echo -e "${C}"
echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—"
echo "â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—"
echo "   â–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•"
echo "   â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—"
echo "   â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘"
echo "   â•šâ•â•      â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•"
echo -e "${N}"
echo -e "${Y}"
typewriter "=========== TYRKROX CONTROL PANEL ==========="
echo -e "${N}"
echo ""
}

pause(){ read -p "Press Enter to continue..." temp; }

# ===== PANEL =====
panel_status() {
if [ -d "/var/www/panel" ]; then
echo -e "${G}PANEL STATUS: INSTALLED âœ…${N}"
else
echo -e "${R}PANEL STATUS: NOT INSTALLED âŒ${N}"
fi
}

install_panel() {
header
panel_status
echo ""
apt update -y & spinner
apt install -y curl git unzip software-properties-common & spinner
echo -e "${G}Panel Base Installed (Demo Setup)${N}"
pause
}

# ===== WINGS =====
install_wings(){
header
apt install -y docker.io & spinner
echo -e "${G}Wings Installed (Docker Ready)${N}"
pause
}

# ===== IVM =====
create_ivm(){
header
echo -e "${C}CREATE IVM (DOCKER BASED)${N}"
apt install -y docker.io & spinner

read -p "Container Name: " NAME
read -p "RAM (MB): " RAM
read -p "CPU Limit: " CPU

docker run -dit --name $NAME --memory="${RAM}m" --cpus="$CPU" ubuntu:22.04 & spinner

echo -e "${G}IVM Created Successfully!${N}"
pause
}

# ===== KVM =====
create_kvm(){
header
echo -e "${C}CREATE KVM${N}"

if ! egrep -q '(vmx|svm)' /proc/cpuinfo; then
echo -e "${R}KVM NOT Supported âŒ${N}"
pause
return
fi

apt install -y qemu-kvm libvirt-daemon-system virtinst & spinner

echo -e "${G}KVM Ready (Manual ISO Required)${N}"
pause
}

# ===== PROXMOX =====
install_proxmox(){
header
echo -e "${C}INSTALL PROXMOX (DOCKER MODE)${N}"

apt install -y docker.io & spinner

docker run -itd \
--name proxmoxve \
--privileged \
-p 8006:8006 \
rtedpro/proxmox:9.0.11 & spinner

echo -e "${G}Proxmox Running on Port 8006 ğŸš€${N}"
pause
}

# ===== START =====
boot_animation

while true; do
header
echo -e "${C}[1]${W} Pterodactyl Panel${N}"
echo -e "${C}[2]${W} Install Wings${N}"
echo -e "${C}[3]${W} Create IVM${N}"
echo -e "${C}[4]${W} Create KVM${N}"
echo -e "${C}[5]${W} Install Proxmox${N}"
echo -e "${R}[6] Exit${N}"
echo ""

read -p "Select Option: " opt

case $opt in
1) install_panel ;;
2) install_wings ;;
3) create_ivm ;;
4) create_kvm ;;
5) install_proxmox ;;
6) exit 0 ;;
*) echo "Invalid Option"; sleep 1 ;;
esac

done
